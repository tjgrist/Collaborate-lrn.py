@model Collaborate_lrn_Py.Models.Quiz

@{
    ViewBag.Title = Model.Name;
}
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")
<script src="http://www.skulpt.org/static/skulpt.min.js" type="text/javascript"></script>
<script src="http://www.skulpt.org/static/skulpt-stdlib.js" type="text/javascript"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
<script src="~/Scripts/react/react.min.js"></script>
@*<script src="@Url.Content("~/Scripts/JSX/GoodJob.jsx")"></script>*@

<h2>@ViewBag.Title <small>Quiz</small></h2>
<div class="container">
    <div class="jumbotron">
        <dl class="dl-horizontal">
            <dt>
                @Html.DisplayNameFor(model => model.Goal)
            </dt>

            <dd>
                <pre>@Html.DisplayFor(model => model.Goal)</pre>
            </dd>

            <dt>
                @Html.DisplayNameFor(model => model.Instruction)
            </dt>

            <dd>
                <pre>@Html.DisplayFor(model => model.Instruction)</pre>
            </dd>
            <dt></dt>
            <dd>

            </dd>
        </dl>
    </div>
</div>
<div class="container" align="center">
    <div class="jumbotron">
        <h3>Try It:</h3>
        <p>Remember to use four spaces instead of tabs when indenting.</p>
        <form>
            <textarea id="yourcode" cols="80" rows="10">Write your code here.</textarea>
            <br />
            <button type="button" class="btn btn-primary" onclick="runit()">Run</button>
            <button type="button" class="btn btn-primary" onclick="checkCode()">Check</button>
        </form>
        <br />
        <pre id="output"></pre>
        <!-- If you want turtle graphics include a canvas -->
        <div id="mycanvas"></div>
        <div id="result"></div>
    </div>
    <!-- Trigger the modal with a button -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">See Answer</button>
    @Html.ActionLink("Complete", "Complete", "Profile", null, new { @class = "btn btn-primary"})
</div>
<div class="container">

</div>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">@Html.DisplayNameFor(model => model.Answer)</h4>
            </div>
            <div class="modal-body">
                <pre><code class="python" id="show">@Html.DisplayFor(model => model.Answer)</code></pre>
            </div>
            </div>
        </div>

    </div>


    @*<script src="~/Scripts/browserpy.js" type="text/javascript"></script>*@
    @*<div id="formSection">
        <h4>@ViewBag.Message</h4>
            @using (Ajax.BeginForm(
                            "Upvote",
                            "Tutorial",
                            new AjaxOptions
                            {
                                UpdateTargetId = "result",
                                InsertionMode = InsertionMode.Replace,
                                HttpMethod = "post", 
                            }))
            {
                 <input class="btn btn-primary" type="submit" value="Upvote"/>
            }
    </div>*@




<script>
    function outf(text) {
        var mypre = document.getElementById("output");
        mypre.innerHTML = mypre.innerHTML + text;
    }
    function builtinRead(x) {
        if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
        return Sk.builtinFiles["files"][x];
    }

    function runit() {
        var prog = document.getElementById("yourcode").value;
        var mypre = document.getElementById("output");
        isCorrect(prog, mypre);
        mypre.innerHTML = '';
        Sk.pre = "output";
        Sk.configure({ output: outf, read: builtinRead });
        (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
        var myPromise = Sk.misceval.asyncToPromise(function () {
            return Sk.importMainWithBody("<stdin>", false, prog, true);
        });
        myPromise.then(function (mod) {
            console.log('success');
        },
            function (err) {
                console.log(err.toString());
            });
    }
    function isCorrect(prog, outp) {
        console.log(outp);
        var stprog = prog.replace(/'/g, '');
        console.log(stprog);
        var correctOutput = "@Model.ExpectedOutput";
        if (stprog === correctOutput) {
            console.log("correct!")
            return true;
        }
        else {
            console.log("hm...")
            return false;
        }
    }
    function checkCode() {
        var output = document.getElementById("output").innerHTML.replace(" ", "");
        console.log(output);
        console.log(output);
        var correctOutput = '@Model.ExpectedOutput';
        console.log("+ " + correctOutput.replace(" ", ""));
        if (output == correctOutput.replace(" ", "")) {
            console.log("Correct output.")
            $("#result").html("That's right!").css("color", "green");
        }
        else if ($("#output").html() == correctOutput) {
            console.log("That's right!");
        }
        else {
            console.log("Not the right output.")
            $("#result").html("That's incorrect.").css("color", "red");
        }
    }
</script>
